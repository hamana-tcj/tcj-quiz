# CSV投入でSupabase Authにユーザー登録する手順（初心者向け）

このガイドでは、CSVファイルを使ってSupabase Authにユーザーを一括登録する方法を、初心者向けに詳しく説明します。

## 📋 目次

1. [準備するもの](#準備するもの)
2. [CSVファイルの準備](#csvファイルの準備)
3. [ユーザー登録の実行](#ユーザー登録の実行)
4. [結果の確認](#結果の確認)
5. [よくある質問](#よくある質問)

---

## 準備するもの

### 必要なもの
- ✅ パソコン（Windows、Mac、Linux どれでも可）
- ✅ インターネット接続
- ✅ CSVファイル（メールアドレス一覧）
- ✅ ブラウザ（Chrome、Firefox、Safari、Edge など）

### 必要な情報
- ✅ アプリのURL（例: `https://your-project.vercel.app`）
  - このURLは、システム管理者から提供されます

---

## CSVファイルの準備

### ステップ1: CSVファイルを作成する

CSVファイルは、**メモ帳**や**Excel**、**Googleスプレッドシート**などで作成できます。

#### 方法A: メモ帳で作成する場合

1. **メモ帳を開く**
   - Windows: 「メモ帳」を検索して開く
   - Mac: 「テキストエディット」を開く

2. **以下の形式で入力する**

   **形式1: メールアドレスのみ（推奨）**
   ```
   email
   user1@example.com
   user2@example.com
   user3@example.com
   ```

   **形式2: メールアドレス + kintoneレコードID**
   ```
   email,kintone_record_id
   user1@example.com,123
   user2@example.com,456
   user3@example.com,789
   ```

3. **ファイルを保存する**
   - ファイル名: `users.csv`（任意の名前でOK）
   - 保存形式: **UTF-8**（重要！）
   - メモ帳の場合: 「名前を付けて保存」→「文字コード」を「UTF-8」に選択

#### 方法B: Excelで作成する場合

1. **Excelを開く**

2. **1行目にヘッダーを入力**
   - A1セル: `email`
   - B1セル（オプション）: `kintone_record_id`

3. **2行目以降にデータを入力**
   - A2セル: `user1@example.com`
   - A3セル: `user2@example.com`
   - （以下同様）

4. **CSV形式で保存**
   - 「ファイル」→「名前を付けて保存」
   - 「ファイルの種類」を「CSV UTF-8（コンマ区切り）(*.csv)」に選択
   - ファイル名を入力して保存

#### 方法C: Googleスプレッドシートで作成する場合

1. **Googleスプレッドシートを開く**

2. **1行目にヘッダーを入力**
   - A1セル: `email`
   - B1セル（オプション）: `kintone_record_id`

3. **2行目以降にデータを入力**

4. **CSV形式でダウンロード**
   - 「ファイル」→「ダウンロード」→「カンマ区切りの値 (.csv)」

### ステップ2: CSVファイルの形式を確認する

✅ **正しい形式の例**

```
email
user1@example.com
user2@example.com
user3@example.com
```

❌ **間違った形式の例**

```
user1@example.com
user2@example.com
```
→ ヘッダー行（`email`）がありません

```
email,名前
user1@example.com,田中太郎
```
→ `email`列は必須ですが、他の列があっても問題ありません

### ステップ3: メールアドレスの形式を確認する

✅ **正しいメールアドレス**
- `user@example.com`
- `test.user+1@gmail.com`
- `user123@company.co.jp`

❌ **間違ったメールアドレス**
- `user@`（@の後にドメインがない）
- `@example.com`（@の前にユーザー名がない）
- `user example.com`（@がない）
- `user@example`（.comなどのTLDがない）

---

## ユーザー登録の実行

### ステップ1: 登録ページにアクセスする

1. **ブラウザを開く**

2. **以下のURLにアクセス**
   ```
   https://your-domain.vercel.app/import-users.html
   ```
   ⚠️ `your-domain.vercel.app` の部分は、実際のアプリのURLに置き換えてください。

3. **登録ページが表示されることを確認**
   - 「ユーザー一括登録（CSV）」というタイトルが表示されます
   - 「CSVファイルを選択」というボタンがあります

### ステップ2: CSVファイルをアップロードする

1. **「CSVファイルを選択」ボタンをクリック**
   - ファイル選択ダイアログが開きます

2. **作成したCSVファイルを選択**
   - ファイルを選択して「開く」をクリック

3. **「アップロードして登録」ボタンをクリック**
   - 処理が開始されます
   - 「処理中...」と表示されます

4. **処理完了を待つ**
   - 処理には、登録するユーザー数によって時間がかかります
   - 100件で約10～30秒程度
   - 1000件で約2～5分程度

### ステップ3: 結果を確認する

処理が完了すると、以下のような結果が表示されます：

```
✅ 登録完了

処理時間: 15.32秒

項目        件数
総件数      100件
作成        95件
スキップ    5件（既存）
失敗        0件
```

#### 結果の見方

- **総件数**: CSVファイルに含まれていたユーザー数
- **作成**: 新規に登録されたユーザー数
- **スキップ（既存）**: 既に登録されていたユーザー数（重複登録を防ぐため）
- **失敗**: 登録に失敗したユーザー数

---

## 結果の確認

### 方法1: Supabaseダッシュボードで確認

1. **Supabaseダッシュボードにログイン**
   - [https://supabase.com](https://supabase.com) にアクセス
   - プロジェクトを選択

2. **Authentication設定を開く**
   - 左側のメニューから「**Authentication**」を選択
   - 「**Users**」タブを開く

3. **ユーザー一覧を確認**
   - 登録されたユーザーが表示されます
   - 検索機能を使用して、特定のユーザーを検索できます

### 方法2: アプリのAPIエンドポイントで確認

1. **以下のURLにアクセス**
   ```
   https://your-domain.vercel.app/api/list-all-users
   ```

2. **JSON形式で確認**
   - ブラウザで表示するか、JSONビューアーを使用します

---

## よくある質問

### Q1: CSVファイルの文字コードは何にすればいいですか？

**A:** **UTF-8**を推奨します。UTF-8以外の文字コード（Shift-JISなど）を使用すると、文字化けが発生する可能性があります。

### Q2: 既存のユーザーを再度登録しようとするとどうなりますか？

**A:** 既存のユーザーは自動的にスキップされます。エラーにはならず、「スキップ（既存）」としてカウントされます。

### Q3: 大量のユーザー（1000件以上）を登録できますか？

**A:** はい、可能です。ただし、処理に時間がかかる場合があります。また、Vercelのタイムアウト制限（60秒）に達する可能性があるため、500件程度ずつに分けて登録することを推奨します。

### Q4: エラーが発生した場合はどうすればいいですか？

**A:** エラーメッセージを確認してください。よくあるエラーは以下の通りです：

- **「CSVファイルがアップロードされていません」**
  → ファイルが正しく選択されているか確認してください

- **「CSVファイルに"email"列が見つかりません」**
  → ヘッダー行に `email` 列が含まれているか確認してください

- **「無効なメールアドレス形式です」**
  → メールアドレスの形式を確認してください

### Q5: kintoneレコードIDは必須ですか？

**A:** いいえ、オプションです。kintoneレコードIDを指定しない場合は、メールアドレスのみのCSVファイルでも登録できます。

### Q6: 登録されたユーザーのパスワードは何ですか？

**A:** 登録時に自動生成された一時パスワードが設定されます。ユーザーは初回ログイン時にパスワードを変更する必要があります。

### Q7: 登録処理中にページを閉じても大丈夫ですか？

**A:** 処理中にページを閉じると、処理が中断される可能性があります。処理が完了するまで、ページを開いたままにしておくことを推奨します。

### Q8: 同じCSVファイルを再度アップロードしても大丈夫ですか？

**A:** はい、大丈夫です。既存のユーザーは自動的にスキップされるため、重複登録されることはありません。

---

## トラブルシューティング

### 問題1: CSVファイルがアップロードできない

**解決方法:**
- ファイルサイズが大きすぎないか確認（10MB以下を推奨）
- ファイル形式が`.csv`であることを確認
- ブラウザを再読み込みして再度試す

### 問題2: 文字化けが発生する

**解決方法:**
- CSVファイルの文字コードをUTF-8に変更
- Excelで保存する場合、「CSV UTF-8（コンマ区切り）」形式で保存

### 問題3: 一部のユーザーが登録されない

**解決方法:**
- エラーメッセージを確認
- メールアドレスの形式を確認
- 無効なメールアドレスが含まれていないか確認

### 問題4: 処理が途中で止まる

**解決方法:**
- ユーザー数を減らして再度試す（500件程度ずつ）
- インターネット接続を確認
- ブラウザを再読み込みして再度試す

---

## まとめ

1. ✅ CSVファイルを準備（UTF-8形式、ヘッダー行に`email`）
2. ✅ 登録ページにアクセス（`/import-users.html`）
3. ✅ CSVファイルをアップロード
4. ✅ 結果を確認

これで、CSVファイルを使ってSupabase Authにユーザーを一括登録できます！

---

## サポート

問題が発生した場合は、システム管理者に連絡してください。

