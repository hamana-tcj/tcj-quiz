# Supabase Auth ユーザーエクスポート手順書

この手順書では、Supabase Authに登録されているユーザー情報をCSV形式でエクスポートする方法を説明します。

## 目次

1. [概要](#概要)
2. [エクスポート形式について](#エクスポート形式について)
3. [エクスポート手順](#エクスポート手順)
4. [エクスポートされたCSVファイルの確認方法](#エクスポートされたcsvファイルの確認方法)
5. [よくある質問（FAQ）](#よくある質問faq)
6. [トラブルシューティング](#トラブルシューティング)

---

## 概要

Supabase Authに登録されている全ユーザーのメールアドレスを、CSV形式でダウンロードできます。

### エクスポートできる情報

- **メールアドレス**: ユーザーのメールアドレス
- **kintoneレコードID**（オプション）: kintoneと連携している場合のレコードID

### エクスポート形式

2つの形式から選択できます：

1. **シンプル形式**: メールアドレスのみ
2. **フル形式**: メールアドレス + kintoneレコードID

---

## エクスポート形式について

### シンプル形式

メールアドレスのみが含まれる形式です。

**CSVファイルの例:**
```csv
email
user1@example.com
user2@example.com
user3@example.com
```

**用途:**
- メールアドレスの一覧が必要な場合
- メール送信リストの作成
- ユーザー数の確認

### フル形式

メールアドレスとkintoneレコードIDが含まれる形式です。

**CSVファイルの例:**
```csv
email,kintone_record_id
user1@example.com,123
user2@example.com,456
user3@example.com,
```

**用途:**
- kintoneとの連携状況を確認したい場合
- メールアドレスとkintoneレコードIDの対応関係を確認したい場合
- データ移行やバックアップ

**注意:**
- kintoneレコードIDが設定されていないユーザーは、空欄になります

---

## エクスポート手順

### ステップ1: エクスポートページを開く

1. ブラウザを開きます（Google Chrome、Microsoft Edge、Firefoxなど）
2. アドレスバーに以下のURLを入力します：
   ```
   https://your-domain.com/export-users.html
   ```
   > **注意**: `your-domain.com`の部分は、実際のドメイン名に置き換えてください。
   > 
   > 例: `https://tcj-quiz.vercel.app/export-users.html`

3. Enterキーを押すか、URLを開きます

### ステップ2: エクスポート形式を選択

1. ページが開いたら、「エクスポート形式」というドロップダウンメニューが表示されます
2. 以下のいずれかを選択します：
   - **シンプル形式（メールアドレスのみ）**: メールアドレスのみが必要な場合
   - **フル形式（メールアドレス + kintoneレコードID）**: kintoneレコードIDも必要な場合

### ステップ3: CSVファイルをダウンロード

1. 「CSVファイルをダウンロード」ボタンをクリックします
2. 処理中は「処理中...」というメッセージが表示されます
3. 処理が完了すると、自動的にCSVファイルがダウンロードされます

**ダウンロードされるファイル名:**
- `users-YYYY-MM-DD.csv`（例: `users-2025-12-13.csv`）
- 日付はエクスポート実行日が自動的に入ります

### ステップ4: ダウンロード完了の確認

1. ページに「✅ エクスポート完了」というメッセージが表示されます
2. ブラウザのダウンロードフォルダを確認します
3. CSVファイルがダウンロードされていることを確認します

---

## エクスポートされたCSVファイルの確認方法

### Excelで開く場合

1. ダウンロードしたCSVファイルをダブルクリックします
2. Excelが開きます
3. 文字化けしている場合：
   - Excelで「データ」タブをクリック
   - 「テキストファイルから」を選択
   - CSVファイルを選択
   - 「文字コード」で「UTF-8」を選択
   - 「次へ」→「完了」をクリック

### メモ帳（Windows）やテキストエディット（Mac）で開く場合

1. CSVファイルを右クリックします
2. 「プログラムから開く」→「メモ帳」（Windows）または「テキストエディット」（Mac）を選択します
3. ファイルの内容が表示されます

### Googleスプレッドシートで開く場合

1. [Googleスプレッドシート](https://sheets.google.com)を開きます
2. 「ファイル」→「インポート」をクリックします
3. 「アップロード」タブを選択します
4. CSVファイルをドラッグ&ドロップまたは「ファイルを選択」をクリックします
5. 「インポート場所」で「新しいスプレッドシートを作成」を選択します
6. 「データを変換」で「文字エンコード」を「UTF-8」に設定します
7. 「データをインポート」をクリックします

---

## よくある質問（FAQ）

### Q1: エクスポートに時間がかかりますか？

**A:** ユーザー数によって異なりますが、通常は数秒から数十秒程度です。大量のユーザー（1000人以上）がいる場合、1分程度かかる場合があります。

### Q2: エクスポートできるユーザー数の上限はありますか？

**A:** 理論的には上限はありませんが、非常に大量のユーザー（10,000人以上）がいる場合、タイムアウトエラーが発生する可能性があります。その場合は、管理者にご相談ください。

### Q3: パスワード情報もエクスポートできますか？

**A:** いいえ、セキュリティ上の理由から、パスワード情報はエクスポートできません。エクスポートできるのはメールアドレスとkintoneレコードIDのみです。

### Q4: エクスポートしたCSVファイルを編集して、再度インポートできますか？

**A:** はい、CSVファイルを編集して、[CSVインポート機能](./CSV_IMPORT_GUIDE.md)を使用して再度インポートできます。ただし、以下の点に注意してください：
- メールアドレスの形式が正しいこと
- 重複するメールアドレスがないこと
- CSVファイルの形式が正しいこと

### Q5: エクスポートしたCSVファイルの文字コードは何ですか？

**A:** UTF-8です。Excelで開いた際に文字化けする場合は、上記の「エクスポートされたCSVファイルの確認方法」を参照してください。

### Q6: エクスポートしたCSVファイルを削除しても問題ありませんか？

**A:** はい、問題ありません。エクスポートしたCSVファイルは、Supabase Authのデータに影響を与えません。必要に応じて削除してください。

### Q7: エクスポート機能を使用するために、特別な権限は必要ですか？

**A:** いいえ、特別な権限は必要ありません。エクスポートページにアクセスできる方であれば、誰でも使用できます。

### Q8: エクスポートしたCSVファイルに、削除されたユーザーも含まれますか？

**A:** いいえ、削除されたユーザーは含まれません。エクスポートされるのは、現在Supabase Authに登録されているアクティブなユーザーのみです。

---

## トラブルシューティング

### 問題1: 「エクスポートに失敗しました」というエラーが表示される

**原因と対処法:**

1. **ネットワーク接続の問題**
   - インターネット接続を確認してください
   - Wi-Fiや有線LANの接続を確認してください
   - 別のネットワークに切り替えて再試行してください

2. **サーバーの問題**
   - しばらく時間をおいてから再試行してください
   - 問題が続く場合は、管理者にご連絡ください

3. **ブラウザの問題**
   - ブラウザを再起動してください
   - 別のブラウザで試してください（例: Chrome、Edge、Firefox）

### 問題2: CSVファイルがダウンロードされない

**原因と対処法:**

1. **ブラウザのダウンロード設定**
   - ブラウザの設定で、ダウンロードがブロックされていないか確認してください
   - ポップアップブロッカーが有効になっている場合は、一時的に無効にしてください

2. **ダウンロードフォルダの確認**
   - ブラウザのダウンロードフォルダを確認してください
   - ダウンロード履歴からファイルを探してください

3. **ブラウザの再起動**
   - ブラウザを再起動してから、再度エクスポートを試してください

### 問題3: CSVファイルを開いたら文字化けしている

**原因と対処法:**

1. **文字コードの問題**
   - CSVファイルの文字コードはUTF-8です
   - Excelで開く場合は、上記の「エクスポートされたCSVファイルの確認方法」を参照してください

2. **Excelのバージョン**
   - 古いバージョンのExcelを使用している場合、文字化けする可能性があります
   - GoogleスプレッドシートやLibreOffice Calcなどの別のアプリケーションで開いてみてください

### 問題4: 「処理中...」のまま、完了しない

**原因と対処法:**

1. **大量のユーザーがいる場合**
   - ユーザー数が多い場合、処理に時間がかかることがあります
   - 5分程度待ってから、再度試してください

2. **タイムアウトエラー**
   - タイムアウトエラーが発生した場合は、管理者にご連絡ください
   - ユーザー数を減らすか、別の方法でエクスポートする必要がある場合があります

3. **ブラウザの再読み込み**
   - ページを再読み込みしてから、再度エクスポートを試してください

### 問題5: エクスポートされたCSVファイルに、想定より少ないユーザーが含まれている

**原因と対処法:**

1. **フィルタリングの問題**
   - エクスポート機能は、Supabase Authに登録されている全ユーザーをエクスポートします
   - 特定の条件でフィルタリングは行われません

2. **データの確認**
   - Supabase Authの管理画面で、実際のユーザー数を確認してください
   - エクスポートされたCSVファイルの行数と比較してください

---

## 補足情報

### セキュリティに関する注意事項

- エクスポートしたCSVファイルには、ユーザーのメールアドレスが含まれます
- CSVファイルは、個人情報を含む機密情報として扱ってください
- 不要になったCSVファイルは、適切に削除してください
- CSVファイルを共有する場合は、適切なセキュリティ対策を講じてください

### サポート

問題が解決しない場合や、追加のサポートが必要な場合は、管理者にご連絡ください。

---

**最終更新日**: 2025年12月13日

